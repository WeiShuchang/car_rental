{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>RentACar</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{% static 'user_side/css/open-iconic-bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'user_side/css/animate.css' %}">
    <link rel="stylesheet" href="{% static 'user_side/css/owl.carousel.min.css' %}">
    <link rel="stylesheet" href="{% static 'user_side/css/owl.theme.default.min.css' %}">
    <link rel="stylesheet" href="{% static 'user_side/css/magnific-popup.css' %}">
    <link rel="stylesheet" href="{% static 'user_side/css/aos.css' %}">
    <link rel="stylesheet" href="{% static 'user_side/css/ionicons.min.css' %}">
    <link rel="stylesheet" href="{% static 'user_side/css/bootstrap-datepicker.css' %}">
    <link rel="stylesheet" href="{% static 'user_side/css/jquery.timepicker.css' %}">
    <link rel="stylesheet" href="{% static 'user_side/css/flaticon.css' %}">
    <link rel="stylesheet" href="{% static 'user_side/css/icomoon.css' %}">
    <link rel="stylesheet" href="{% static 'user_side/css/style.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">


    <!-- Bootstrap JavaScript (Place this before `</body>`) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<!-- Messenger Container -->
<div class="messenger-container rounded-1">
  <!-- Minimized State -->
  <div class="messenger-minimized bg-primary text-white p-3 d-flex align-items-center shadow rounded-3" onclick="toggleMessenger()">
    <i class="bi bi-chat-left-text me-2"></i>
    <span class="me-1">Messages</span>
    <span class="badge bg-white text-primary" id="unread-count">0</span>
  </div>

  <!-- Expanded State -->
  <div class="messenger-expanded bg-white shadow-lg overflow-hidden rounded-3">
    <!-- Header -->
    <div class="messenger-header bg-primary text-white p-3 d-flex justify-content-between align-items-center ">
      <h5 class="mb-0 text-light">User Messages</h5>
      <button class="btn btn-sm btn-light" onclick="toggleMessenger()">
        <i class="bi bi-dash-lg"></i>
      </button>
    </div>

    <!-- Body -->
    <div class="messenger-body d-flex" style="height: 400px;">
      <!-- Rooms Sidebar -->
      <div class="rooms-sidebar border-end" style="width: 120px;">
        <div class="room-list overflow-auto" style="height:100%">
          <div class="room-item p-2 border-bottom text-center active" data-room="general">
            <div class="room-avatar bg-primary text-white rounded-circle mx-auto mb-1 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
              <i class="bi bi-people-fill"></i>
            </div>
            <div class="room-name small fw-bold text-truncate">General</div>
            <div class="room-time x-small text-muted">Now</div>
          </div>
        </div>
      </div>

      <!-- Chat Area -->
      <div class="chat-area d-flex flex-column flex-grow-1">
        <!-- Chat Header -->
        <div class="chat-header p-2 border-bottom d-flex justify-content-between align-items-center">
          <div class="current-room fw-bold">General Chat</div>
          <button class="btn btn-sm btn-outline-secondary">
            <i class="bi bi-info-circle"></i>
          </button>
        </div>

        <!-- Messages -->
        <div class="messages-container flex-grow-1 overflow-auto p-2" id="message-list">
          <div class="message-item mb-2">
            <div class="message-content bg-light p-2 rounded-2">
              <div class="message-sender small fw-bold">Support Team</div>
              <div class="message-text">Hello! How can we help you today?</div>
              <div class="message-time x-small text-muted text-end">12:30 PM</div>
            </div>
          </div>
        </div>

        <!-- Input Area -->
        <div class="message-input p-2 border-top">
          <div class="input-group">
            <input type="text" class="form-control" placeholder="Type your message..." id="message-input">
            <button class="btn btn-primary" id="send-button">
              <i class="bi bi-send"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<body>

  <style>
    /* Navbar Base Styling */
  .navbar {
    background: #ffffff !important; /* Always solid white */
    box-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.1); /* Soft shadow for depth */
    padding: 8px 0;
  }
  
  .navbar .navbar-brand {
    color: #000000; /* Dark text for contrast */
    font-size: 24px;
    font-weight: bold;
  }
  
  .navbar .navbar-brand span {
    color: #01d28e; /* Green accent */
  }
  
  .navbar .nav-link {
    color: #000000 !important; /* Ensure links are always black */
    font-weight: 500;
    font-size: 16px;
    transition: color 0.3s ease-in-out;
  }
  
  .navbar .nav-link:hover {
    color: #01d28e !important; /* Green hover effect */
  }
  
  .navbar .navbar-toggler {
    border: none;
    color: rgba(0, 0, 0, 0.7) !important;
    font-size: 18px;
  }
  
  /* Mobile Navbar */
  @media (max-width: 991.98px) {
    .navbar {
      background: #ffffff !important;
    }
  
    .navbar .nav-link {
      color: #000000 !important;
    }
  
    .navbar .nav-item.active > .nav-link {
      color: #01d28e !important;
    }
  }
  
  /* CTA Buttons */
  .navbar .nav-item.cta > a {
    color: #ffffff !important;
    background: #01d28e;
    border-radius: 5px;
    padding: 8px 16px;
  }
  
  .navbar .nav-item.cta > a:hover {
    background: #1089ff !important; /* Blue hover effect */
  }
  
  /* Sticky Navbar */
  .sticky-top {
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 1000;
  }
  
  /* Active Link */
  .navbar .nav-item.active > .nav-link {
    color: #01d28e !important;
    font-weight: bold
  }

/* Messenger Container */
/* Messenger Container */
.messenger-container {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 1060;

}

/* Minimized State */
.messenger-minimized {
  cursor: pointer;
  display: none;
  border-radius: 50px; /* pill-shaped */
  gap: 6px; /* small gap between icon and text */
  font-weight: 500;
}

/* Expanded State */
.messenger-expanded {
  width: 600px; /* wider */
  display: none;
  /* Remove rounded border */
  border-radius: 0;
}

/* Active States */
.messenger-minimized.active {
  display: flex;
}

.messenger-expanded.active {
  display: block;
}

/* Room Items */
.room-item {
  cursor: pointer;
}

.room-item.active {
  background-color: #e9f9f3;
}

.room-item:hover:not(.active) {
  background-color: #f8f9fa;
}

/* Messages */
.message-item {
  max-width: 80%;
}

.message-item.sent {
  margin-left: auto;
}

.message-item.sent .message-content {
  background-color: #01d28e !important;
  color: white;
}

.message-item.received {
  margin-right: auto;
}

/* Remove message content rounding */
.message-content {
  border-radius: 0 !important;
}

/* Scrollbars */
.room-list::-webkit-scrollbar,
.messages-container::-webkit-scrollbar {
  width: 5px;
}

.room-list::-webkit-scrollbar-track,
.messages-container::-webkit-scrollbar-track {
  background: #f1f1f1;
}

.room-list::-webkit-scrollbar-thumb,
.messages-container::-webkit-scrollbar-thumb {
  background: #01d28e;
  border-radius: 10px;
}

/* Responsive */
@media (max-width: 576px) {
  .messenger-expanded {
    width: 100vw;
    height: 100vh;
    position: fixed;
    top: 0;
    left: 0;
    border-radius: 0;
  }

  .rooms-sidebar {
    width: 100px !important;
  }
}

.messenger-minimized:not(.active) {
  display: none !important;
}

.messenger-expanded:not(.active) {
  display: none !important;
}

  </style>

<nav class="navbar navbar-expand-lg navbar-dark  bg-dark ftco-navbar-light sticky-top" id="ftco-navbar">
    <div class="container">
     <a class="navbar-brand text-black text-decoration-none" 
      href="{% url 'user_dashboard' %}" 
      style="color: black !important; text-decoration: none !important; cursor: default;">
        Ashley's Car Rental
    </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="oi oi-menu"></span> Menu
        </button>

        <div class="collapse navbar-collapse" id="ftco-nav">
            <ul class="navbar-nav ml-auto">
              <li class="nav-item {% if request.resolver_match.url_name == 'user_dashboard' %}active{% endif %}">
                <a href="{% url 'user_dashboard' %}" class="nav-link">Home</a>
            </li>
            <li class="nav-item {% if request.resolver_match.url_name == 'cars_for_rent' %}active{% endif %}">
                <a href="{% url 'cars_for_rent' %}" class="nav-link">Cars</a>
            </li>
       
          
              <!-- Reservations Dropdown -->
              <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" id="reservationDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      Reservations
                  </a>
                  <div class="dropdown-menu" aria-labelledby="reservationDropdown">
                      <a class="dropdown-item" href="{% url "user_pending_reservations" %}">Pending</a>
                      <a class="dropdown-item" href="{% url "user_approved_reservations" %}">Approved</a>
                      <a class="dropdown-item" href="{% url "user_cancelled_reservations" %}">Cancelled</a>
                  </div>
              </li>
          
              <!-- History Link -->
              <li class="nav-item"><a href="{% url "reservation_history" %}" class="nav-link">History</a></li>
              {% comment %} <li class="nav-item {% if request.resolver_match.url_name == 'history' %}active{% endif %}">
                <a href="{% url 'history' %}" class="nav-link">History</a>
              </li> {% endcomment %}
              <!-- Logout -->
              <li class="nav-item">
                  <a href="{% url 'logout' %}" class="nav-link">
                      Log Out
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-right mb-1" viewBox="0 0 16 16">
                          <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
                          <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
                      </svg>
                  </a>
              </li>
          </ul>
          
        </div>
    </div>
</nav>

{% block content %}

{% endblock content %}

<footer class="ftco-footer ftco-bg-dark ftco-section">
    <div class="container">
      <div class="row mb-5">
        <div class="col-md">
          <div class="ftco-footer-widget mb-4">
            <h2 class="ftco-heading-2"><a href="#" class="logo"><span>Ashley's Car Rental</span></a></h2>
            <p>Rent Cars for affordable prices now! Here at Ashley's Car Rental.</p>
            <ul class="ftco-footer-social list-unstyled float-md-left float-lft mt-5">
              <li class="ftco-animate"><a href="#"><span class="icon-twitter"></span></a></li>
              <li class="ftco-animate"><a href="#"><span class="icon-facebook"></span></a></li>
              <li class="ftco-animate"><a href="#"><span class="icon-instagram"></span></a></li>
            </ul>
          </div>
        </div>
       
        <div class="col-md">
          <div class="ftco-footer-widget mb-4">
              <h2 class="ftco-heading-2">Have a Questions?</h2>
              <div class="block-23 mb-3">
                <ul>
                  <li><span class="icon icon-map-marker"></span><span class="text">Camp Dangwa, La Trinidad Benguet 2601 Philippines</span></li>
                  <li><a href="#"><span class="icon icon-phone"></span><span class="text">+639122042550</span></a></li>
                  <li><a href="#">ashleycarrental.pythonanywhere.com</span></a></li>
                </ul>
              </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12 text-center">

          <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
Copyright Ashley's Car Rental&copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart color-danger" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
        </div>
      </div>
    </div>
  </footer>

<!-- Loader -->
<div id="ftco-loader" class="show fullscreen">
    <svg class="circular" width="48px" height="48px">
        <circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/>
        <circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00"/>
    </svg>
</div>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Initial state
    let isMessengerMinimized = false;
    let currentRoom = 'general';
    const rooms = {
      'general': [
        { sender: 'Support Team', text: 'Welcome to the general chat!', time: '12:30 PM', type: 'received' }
      ],
      'support': [
        { sender: 'Customer Support', text: 'How can we assist you?', time: '11:45 AM', type: 'received' }
      ]
    };
    
    // DOM elements
    const messengerMinimized = document.querySelector('.messenger-minimized');
    const messengerExpanded = document.querySelector('.messenger-expanded');

    const roomList = document.querySelector('.room-list');
    const messageList = document.getElementById('message-list');
    const messageInput = document.getElementById('message-input');
    const sendButton = document.getElementById('send-button');
    const currentRoomDisplay = document.querySelector('.current-room');
    const unreadCount = document.getElementById('unread-count');
    
    // Initialize
    updateMessengerView();
    renderRoomMessages(currentRoom);
    
    // Toggle messenger between minimized and expanded
    window.toggleMessenger = function() {
      isMessengerMinimized = !isMessengerMinimized;
      updateMessengerView();
      
      if (!isMessengerMinimized) {
        // Mark messages as read when opening
        updateUnreadCount(0);
      }
    };
    

    // Send message
    function sendMessage() {
      const messageText = messageInput.value.trim();
      if (messageText) {
        const now = new Date();
        const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        
        const newMessage = {
          sender: 'You',
          text: messageText,
          time: timeString,
          type: 'sent'
        };
        
        // Add to current room
        rooms[currentRoom].push(newMessage);
        renderMessage(newMessage);
        
        // Clear input
        messageInput.value = '';
        
        // Simulate reply in general chat
        if (currentRoom === 'general') {
          setTimeout(() => {
            const replyMessage = {
              sender: 'Support Team',
              text: 'Thanks for your message! We\'ll get back to you soon.',
              time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
              type: 'received'
            };
            rooms[currentRoom].push(replyMessage);
            renderMessage(replyMessage);
            
            // Update unread count if minimized
            if (isMessengerMinimized) {
              updateUnreadCount(parseInt(unreadCount.textContent) + 1);
            }
          }, 1000);
        }
      }
    }
    
    sendButton.addEventListener('click', sendMessage);
    messageInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });
    
    // Helper functions
    function updateMessengerView() {
      if (isMessengerMinimized) {
        messengerMinimized.classList.add('active');
        messengerExpanded.classList.remove('active');
      } else {
        messengerMinimized.classList.remove('active');
        messengerExpanded.classList.add('active');
      }
    }
    
    function switchRoom(room) {
      currentRoom = room;
      
      // Update active room in sidebar
      document.querySelectorAll('.room-item').forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('data-room') === room) {
          item.classList.add('active');
        }
      });
      
      // Update room display
      currentRoomDisplay.textContent = room.charAt(0).toUpperCase() + room.slice(1) + ' Chat';
      
      // Render messages
      renderRoomMessages(room);
    }
    
    function renderRoomMessages(room) {
      messageList.innerHTML = '';
      if (rooms[room]) {
        rooms[room].forEach(message => {
          renderMessage(message);
        });
      }
      scrollToBottom();
    }
    
    function renderMessage(message) {
      const messageElement = document.createElement('div');
      messageElement.className = `message-item mb-2 ${message.type}`;
      
      messageElement.innerHTML = `
        <div class="message-content p-2 rounded ${message.type === 'sent' ? 'bg-primary text-white' : 'bg-light'}">
          <div class="message-sender small fw-bold">${message.sender}</div>
          <div class="message-text">${message.text}</div>
          <div class="message-time x-small text-end ${message.type === 'sent' ? 'text-white-50' : 'text-muted'}">${message.time}</div>
        </div>
      `;
      
      messageList.appendChild(messageElement);
      scrollToBottom();
    }
    
    function addRoomToSidebar(room) {
      const roomItem = document.createElement('div');
      roomItem.className = 'room-item p-2 border-bottom text-center';
      roomItem.setAttribute('data-room', room);
      
      roomItem.innerHTML = `
        <div class="room-avatar bg-primary text-white rounded-circle mx-auto mb-1 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
          <i class="bi bi-chat-dots"></i>
        </div>
        <div class="room-name small fw-bold text-truncate">${room}</div>
        <div class="room-time x-small text-muted">Now</div>
      `;
      
      roomList.appendChild(roomItem);
      
      // Add click event
      roomItem.addEventListener('click', function() {
        switchRoom(room);
      });
    }
    
    function scrollToBottom() {
      messageList.scrollTop = messageList.scrollHeight;
    }
    
    function updateUnreadCount(count) {
      unreadCount.textContent = count;
      if (count > 0) {
        unreadCount.style.display = 'inline-block';
      } else {
        unreadCount.style.display = 'none';
      }
    }
  });
</script>
<script>
  // Toggle messenger view
  function toggleMessenger() {
  const minimized = document.querySelector(".messenger-minimized");
  const expanded = document.querySelector(".messenger-expanded");

  const isExpanded = expanded.classList.contains("active");

  if (isExpanded) {
    expanded.classList.remove("active");
    minimized.classList.add("active");
    localStorage.setItem("messengerState", "minimized");
  } else {
    expanded.classList.add("active");
    minimized.classList.remove("active");
    localStorage.setItem("messengerState", "expanded");
  }
}


  // On page load
  document.addEventListener("DOMContentLoaded", function () {
    const minimized = document.querySelector(".messenger-minimized");
    const expanded = document.querySelector(".messenger-expanded");
    const state = localStorage.getItem("messengerState") || "minimized";

    if (state === "expanded") {
      expanded.classList.add("active");
      minimized.classList.remove("active");
    } else {
      expanded.classList.remove("active");
      minimized.classList.add("active");
    }
  });
</script>


<script src="{% static 'user_side/js/jquery.min.js' %}"></script>
<script src="{% static 'user_side/js/jquery-migrate-3.0.1.min.js' %}"></script>
<script src="{% static 'user_side/js/popper.min.js' %}"></script>
<script src="{% static 'user_side/js/bootstrap.min.js' %}"></script>
<script src="{% static 'user_side/js/jquery.easing.1.3.js' %}"></script>
<script src="{% static 'user_side/js/jquery.waypoints.min.js' %}"></script>
<script src="{% static 'user_side/js/jquery.stellar.min.js' %}"></script>
<script src="{% static 'user_side/js/owl.carousel.min.js' %}"></script>
<script src="{% static 'user_side/js/jquery.magnific-popup.min.js' %}"></script>
<script src="{% static 'user_side/js/aos.js' %}"></script>
<script src="{% static 'user_side/js/jquery.animateNumber.min.js' %}"></script>
<script src="{% static 'user_side/js/bootstrap-datepicker.js' %}"></script>
<script src="{% static 'user_side/js/jquery.timepicker.min.js' %}"></script>
<script src="{% static 'user_side/js/scrollax.min.js' %}"></script>
<script src="{% static 'user_side/js/google-map.js' %}"></script>
<script src="{% static 'user_side/js/main.js' %}"></script>

</body>
</html>
